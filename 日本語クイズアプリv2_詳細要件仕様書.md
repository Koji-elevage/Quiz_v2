# 日本語クイズアプリ v2 詳細要件仕様書

最終更新日: 2026-02-24
対象: 授業連動型語学クイズアプリ「日本語クイズ」 v2 アップデート

## 1. 目的とスコープ
- 学習者のモチベーション向上を目的に、進捗バー、クリア時のアニメーション（紙吹雪など）を導入する。
- **データ構造の拡張**: UIの充実に伴い、DBに保存するJSON構造（`questions_json`）を拡張する。
- **アーキテクチャの分離**: V2のプロトタイプUI（1ファイル）を、V1同様に「管理者画面」「学習者画面」「サーバー/DB」に分割・統合する。
- **運用導線の明確化**: 学習者の正規導線は「管理者配布のQR（`/quiz/:id`）」とし、トップ（`/`）は説明ページとして扱う。
- **管理系保護**: 管理系APIは `ADMIN_TOKEN` 認証を必須にする。

## 2. ユーザー種別
- 管理者: クイズ作成（リッチデータ対応）、一覧確認、削除、QR 発行。
- 学習者: クイズ受験（穴埋め形式）、結果・詳細解説の確認。

## 3. 画面・機能要件
### 3.1 管理者画面 `/admin` (新規または改修)
- 入力項目の大幅な追加（各問題に対して以下の設定が可能になること）
  - 設問文（`prompt`。例: "【この状況に合う言葉は？】"）
  - **穴埋め文**（`sentence`。例: "梅雨の時期、一日中（　　）と雨が降っている。"）
  - 選択肢（**V1の要件通り3つに固定**。1つが正解）
  - **正解の理由/解説**（`explanation`。後方互換で `why` も受理）
  - **他選択肢の解説**（`others`：他選択肢ごとの使用場面、例文）
  - 画像URL（任意）
- 管理者の非技術ユーザー運用を考慮し、以下を満たすこと。
  - `?token=` 付きURLから管理トークンを自動保存できる
  - 固定フォールバックトークン設定時は、トークン入力ダイアログなしで利用できる

### 3.2 学習者画面 `/quiz/[id]` (新規)
- **クイズ回答画面**
  - 進行状況バーの表示
  - 穴埋め問題UI（空欄 `(　　)` を含む文章の表示）
- **詳細解説画面（Feedback Screen）**
  - 正解時の紙吹雪（Confetti）アニメーション
  - タブ切り替えUI（「正解理由」「他選択肢」の2タブ構成）
  - スケール図やアイコンを活用した視覚的な情報提示
- **結果画面（Results Screen）**
  - バッチまたは全体の終了時に、正解率、正解数、復習おすすめ単語を表示する。
- **トップページ `/`**
  - 「QRからアクセスしてください」を明示する説明ページとして表示する
  - `?quiz=<id>` が付与される場合のみ、名前入力と開始導線を表示する

## 4. データ要件（スキーマ定義案）
SQLiteの `quizzes` テーブル（`id`, `title`, `questions_json`, `created_at`）は変更せず、`questions_json` 内のオブジェクト構造を以下に拡張する。

```json
{
  "id": "uuid",
  "imageUrl": "https://...",
  "prompt": "設問文",
  "sentence": "穴埋め用例文（　　）付き",
  "correctIndex": 0,
  "choices": ["しとしと", "ざあざあ", "ぽつぽつ"],
  "explanation": "正解理由テキスト",
  "others": [
    { "word": "ざあざあ", "usage": "大雨", "example": "「雨がざあざあ降る」" },
    { "word": "ぽつぽつ", "usage": "降り始め", "example": "「雨がぽつぽつ降る」" }
  ]
}
```

補足:
- APIは後方互換のため `question` / `why` / `image` も受理するが、保存時は `prompt` / `explanation` / `imageUrl` を正規形とする。

## 5. UI/UX 要件
- レスポンシブ対応: 学習者向けはスマホネイティブアプリ風のUI（`width: 100vw; height: 100vh` ベース）、管理画面はPC/タブレット操作に適したUIとする。
- アンドロイド・iOS双方のWebブラウザでのタップ操作を意識し、アニメーション（CSS `transition` / `keyframes`）を活用する。
- セキュリティ要件:
  - ユーザー入力値を `innerHTML` へ直接注入しない（XSS対策）
  - 管理系APIは `Authorization: Bearer <ADMIN_TOKEN>` を必須化
  - AI系・画像アップロードAPIは簡易レート制限を適用

## 6. 受け入れ基準
- 管理者画面で、V2用の追加情報（穴埋め文、タブ用解説等）を含めたクイズが作成・保存できること。
- 保存したクイズを学習者画面で開き、V2の新しいUIレイアウトで問題が解けること。
- 選択肢はV1の要件を引き継ぎ、常に3つで出題されること。
- クイズ終了時、詳細な結果画面が表示されること。
- 管理APIに未認証でアクセスした場合は `401`、認証済みなら正常応答すること。
- 学習者はQR配布導線（`/quiz/:id`）で利用でき、トップ（`/`）から用途が誤解されないこと。
